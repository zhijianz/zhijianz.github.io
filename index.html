<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.svg?v=5.1.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="zhijianz">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="zhijianz">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="zhijianz">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>zhijianz</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zhijianz</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Coder on way!</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/26/常见内存泄漏/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhijianz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.svg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zhijianz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/26/常见内存泄漏/" itemprop="url">
                  常见内存泄漏
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-26T12:56:50+08:00">
                2017-06-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="属性动画cancel的必要性"><a href="#属性动画cancel的必要性" class="headerlink" title="属性动画cancel的必要性"></a>属性动画cancel的必要性</h1><p>关键词ThreadLocal</p>
<p>在<code>ValueAnimator</code>中，创建并执行一个动画的时候会将属性动画对象最终会被放置到<code>ThreadLocal</code>对象中，如果该动画是个定时结束的动画按理说不会存在什么问题，但是如果执行的是一个重复不会停止播放的动画，就需要在界面退出的时候主动调用属性动画的<code>cancel</code>函数将其从<code>ThreadLocal</code>中移除避免界面在依然被引用无法释放。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/04/Trick-of-Remove-View/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhijianz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.svg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zhijianz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/04/Trick-of-Remove-View/" itemprop="url">
                  Trick of Remove View
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-04T12:41:32+08:00">
                2017-06-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ViewGroup.removeAllViews</div><div class="line">	ViewGroup.removeAllViewsInLayout</div><div class="line">		View.dispathDetachFromWindow</div><div class="line">	ViewGroup.requestLayout</div><div class="line">	ViewGroup.invalidate</div></pre></td></tr></table></figure>
<p>在ViewGroup移除子View的操作中，会调用上面描述的执行流程。在这个执行过程中，遍历的过程会清除子view的焦点之类的状态并将其从容器子view数组中移除。<code>RelativeLayout</code>在继承容器的时候并没有对这个执行流程改写，但是它在自己的布局流程中会另外创建两个数组保存相关子view用来辅助布局。这两个辅助的布局在移除子view的时候并不会进行删除的操作，这就导致期望通过<code>removeView</code>清除子view回收对象内存的时候就会达不到预期，因为子view一直被其引用。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/03/WebView-的坑/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhijianz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.svg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zhijianz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/03/WebView-的坑/" itemprop="url">
                  WebView 的坑
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-03T10:33:32+08:00">
                2017-06-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="构造函数异常"><a href="#构造函数异常" class="headerlink" title="构造函数异常"></a>构造函数异常</h1><p><code>WebView</code>在一些特定机型中会出现构造函数运行异常的情况，解决的方式只能够是在出现问题的地方将问题try住，保证程序尽量的正常运行。</p>
<ul>
<li>Xiaomi MI PAD 2 + Android 5.1</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">android.util.AndroidRuntimeException: java.lang.RuntimeException: Invalid reflection</div><div class="line">	at android.webkit.WebViewFactory.getProvider(WebViewFactory.java)</div><div class="line">	at android.webkit.WebView.getFactory(WebView.java)</div><div class="line">	at android.webkit.WebView.ensureProviderCreated(WebView.java)</div><div class="line">	at android.webkit.WebView.setOverScrollMode(WebView.java)</div><div class="line">	at android.view.View.(View.java)</div><div class="line">	at android.view.View.(View.java)</div><div class="line">	at android.view.ViewGroup.(ViewGroup.java)</div><div class="line">	at android.widget.AbsoluteLayout.(AbsoluteLayout.java)</div><div class="line">	at android.webkit.WebView.(WebView.java)</div><div class="line">	at android.webkit.WebView.(WebView.java)</div><div class="line">	at android.webkit.WebView.(WebView.java)</div><div class="line">	at android.webkit.WebView.(WebView.java)</div><div class="line">	at android.webkit.WebView.(WebView.java)</div><div class="line">	at com.duowan.makefriends.dialog.TransparentWebDialog.initWebView(TransparentWebDialog.java)</div><div class="line">	at com.duowan.makefriends.dialog.TransparentWebDialog.showWebDialog(TransparentWebDialog.java)</div></pre></td></tr></table></figure>
<h1 id="重定向引起的返回循环"><a href="#重定向引起的返回循环" class="headerlink" title="重定向引起的返回循环"></a>重定向引起的返回循环</h1>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/25/Think-In-Java/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhijianz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.svg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zhijianz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/25/Think-In-Java/" itemprop="url">
                  Think In Java
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-25T00:32:35+08:00">
                2017-05-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="初始化流程"><a href="#初始化流程" class="headerlink" title="初始化流程"></a>初始化流程</h1><p>Java的运行过程，尽量确保所有变量在使用之前都得到初始化。对于局部变量，编译器会在使用未初始化变量的时候抛出异常来达到这一目的；而对象内字段则使用了一套固定的初始化流程确保每个字段在使用之前都得到正确的初始化。</p>
<p>在程序中使用到一个类的时候，首先会将class文件加载到内存并创建这个类对应的class对象。在这个类加载的过程中，会同时进行类静态字段的初始化操作。这里提及的静态字段除了用<code>static</code>关键字修饰的字段之外，还可以是该关键字修饰的代码块。静态字段定义位置的初始化语句以及静态代码块在类加载的过程都会按照定义的先后顺序执行完成这部分的初始化操作。</p>
<p>实例化一个对象的时候，首先会在堆中为该对象清理出一块对应的内存空间，清理的过程将所有的位都设为0保证了对象字段的第一个初始化都会存在一个默认初始基准值。此后，在没有类字段需要实例化操作的基础上，按照字段的定义顺序执行成员变量的实例化操作和定义的实例化语句块。在上面的实例化操作都执行完成之后才会到我们所熟悉的构造函数。</p>
<p>对于具备长继承链的对象初始化的流程也可以参考上面的加载，实例化的逻辑。加载的过程从继承链最顶端的基类开始加载并进行静态的初始化操作，而后的实例化流程依然遵从一样的执行顺序，类加载和初始化流程分开两个阶段执行。</p>
<h1 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h1><p>Java面向对象的理念深入在整套语言体系中。从本书最开始的内容就提及类库提供者和客户端程序员彼此之间的代码封装问题。Java提倡的正确封装方式是在类库提供者提供给客户端程序员的只是一些必须的公共接口，而内部的实现逻辑对于客户端程序员来说是不可见的。这种将具体数据和方法放入类中然后进行具体实现隐藏的封装保证了双方直接的独立性，在类库提供者进行某些实现的改动的时候不会影响到客户端程序员对现有接口的使用。Java定义的最基本的编译单元是一个Java文件，将多个编译单元放置在一个包中实现统一的命名空间控制，同时保证良好的代码组织结构。Java提供的多种访问性控制属性帮助在上述命名空间结构下实现封装的目的。在Java的编译单元中，只能有一个开放的访问接口，这个接口通过一个<code>public</code>修饰的类来实现，此后类中各种属性和方法的访问性控制细分具体的分装实现。从最顶层的包命名空间控制到其组织多个编译单元，进而深入其中的各个类和属性构成一个比较合理的项目结构。</p>
<h1 id="复用"><a href="#复用" class="headerlink" title="复用"></a>复用</h1><p>代码的复用应该是每个高级程序设计语言的基本功能，Java提供基础的<code>组合、继承、代理</code>三种不同类型的代码复用方式。从良好的程序设计模式的角度出发，程序中非必要的情况下都应该使用组合实现代码的复用而保证必要的继承。代理介于组合和继承两者直接的实现方式，为外部调用者提供和被代理对象一致接口的同时，保证的组合的灵活性。</p>
<h1 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h1><p>Java在面向对象上的实现最令人影响深刻的应该是其多态的内容。在Java中，一个类在经历的封装和实现抽象成为一个新类型之后，还可以当做其基类来使用，这种数据类型窄化的过程在Java中称为向上转型。向上转型依托于Java的动态绑定机制实现。在程序中，将函数调用和其对应的函数体关联起来的过程称为绑定。在编译期就确定这种绑定关系的称为前期绑定，大多数面向过程的语言（例如C）默认使用的就是前期绑定；在运行时确定绑定关系的称为后期绑定或动态绑定。Java对于除<code>static/final/privite</code>修饰的函数都默认采用动态绑定（域的引用在编译期就已经确定，属于前期绑定）。动态绑定保证程序在运行时可以找到正确的执行代码，集成机制在编译期就保证了参数接口的一致，这两者共同作用保证了向上转型的有效性。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/12/重走OOP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhijianz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.svg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zhijianz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/12/重走OOP/" itemprop="url">
                  重走OOP
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-12T00:23:12+08:00">
                2017-05-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="OOP-用问题描述问题"><a href="#OOP-用问题描述问题" class="headerlink" title="OOP:用问题描述问题"></a>OOP:用问题描述问题</h1><p>任何一种计算机语言都提供抽象的能力。底层的汇编语言实现了对计算机硬件的轻微抽象，而后出现的C等指令式语言在汇编的基础上再一次进行抽象过程。但使用计算机解决问题的过程中最终所期望的是完成问题空间（具体要解决的某个问题、某项业务）抽象到解空间（解决问题的程序、或者说计算机）的映射。OOP可以对问题空间中的任意元素部件进行抽象映射到解空间中成为我们所熟知的对象（具体到编程语言应该描述为类更加恰当），通过这些对象的存在构建出对应的解空间实现用问题空间描述问题的空间的目的，避免走向使用解决方案描述问题的老路。同时，因为对象的新增完全取决于当前问题空间的元素内容，所以OOP提供的解决方案是更加具备适应性的。</p>
<h1 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h1><p>OOP的多态依托于编译期在编译代码的时候采用的并不是传统的前期绑定，在编译期将要执行的每一句命令都写死下来，而是采用一种后期绑定的方式，执行命令的位置通过一段代码后期计算出来。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/04/JVM-基础理论/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhijianz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.svg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zhijianz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/04/JVM-基础理论/" itemprop="url">
                  JVM 基础理论
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-04T12:48:27+08:00">
                2017-05-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>Java技术体系由下面的几个部分组成：</p>
<ul>
<li>Java程序设计语言</li>
<li>Java虚拟机</li>
<li>Java API</li>
<li>第三方开源或商用API</li>
<li>class 文件格式</li>
</ul>
<p>其中，可以向前三者统称为JDK(Java Development Kit)</p>
<h1 id="自动内存管理机制"><a href="#自动内存管理机制" class="headerlink" title="自动内存管理机制"></a>自动内存管理机制</h1><h2 id="内存模型"><a href="#内存模型" class="headerlink" title="内存模型"></a>内存模型</h2><p>JVM根据Java程序语言的特点和程序运行时需求将其内存构建成如下的模型：</p>
<ul>
<li>程序计数器（线程私有）</li>
<li>虚拟机栈（线程私有）</li>
<li>本地方法栈（线程私有）</li>
<li>堆（线程公有）</li>
<li>方法区（线程公有）<ul>
<li>运行时常量池（方法区一部分）</li>
</ul>
</li>
</ul>
<p>上面的内存模型在程序运行的时候服务于不同的需求。</p>
<p>Java程序运行的时候，线程需要不断的从字节码文件中获取下一条执行的命令，这条将要执行的字节码位置就保存在程序计数器这块内存中；同时，程序计数器保存下一条字节码地址还可以用于多线程切换之后恢复之前的执行场景。</p>
<p>虚拟机栈和本地方法栈实际上都是用来服务当前线程的方法执行，区别在于虚拟机栈中放置的是Java方法的栈帧而本地方法栈放置的是本地方法的栈帧；在当前线程中，每一个方法执行的开始和结束都对应着方法栈中的栈帧入栈和出栈，每个栈帧中放置着该方法局部变量表，方法出口和动态链接等内容。</p>
<p>Java作为一种面向对象的程序设计语言，程序的运行依托于对象的创建和使用。堆中分配出来的内存用来保存程序运行过程中创建出来的对象和数组（这个说法据说并不是很绝对，但是对于概念的理解没有太大的影响）。这一块内存区域应该是大部分Java开发人员所熟知的，因为这块内存同时也是垃圾回收的主要战场，因此也会被称为GC堆。</p>
<p>方法区用来放置类的加载信息、类型信息、静态变量以及程序编译期生成的字面常量等内容。因为这块内存中保存的内容通常情况下不会与太大的变动，所以一直都是垃圾回收的重灾区，回收的效率极其低下。在有一些虚拟机实现中甚至不会实现这个区域的垃圾回收机制。运行时常量池是方法区中的一部分，用来保存之前提及的编译期生成的字面常量。相对应的在class文件中也存在一份常量池，运行时常量池除了保存了class文件中常量池包含的常量内容之外，在运行时亦可以向其中增加新的内容，最常见的一个用法是<code>String.intern()</code>。</p>
<p>在通过引用访问一个对象的时候，引用命中的内容并不仅仅只有该对象在堆中内存，同时还有其方法区中用于保存类信息（比如实现了那些接口等）的内存地址，具体的命中方式取决于引用实现的方式是句柄还是通过堆内存二次引导到方法区。</p>
<h1 id="垃圾回收方法论"><a href="#垃圾回收方法论" class="headerlink" title="垃圾回收方法论"></a>垃圾回收方法论</h1><p>Java虚拟机不同的实现提供了多种的垃圾回收器适用于不同的场景，详细的去学习每种回收器的工作原理就目前来说没有太大的意义。所以这里只是记述垃圾回收中要用的一些基础理论。</p>
<p>整个垃圾回收方法的发展过程都围绕着下面三个记述的问题进行：</p>
<ul>
<li>什么样的对象可以回收</li>
<li>什么时候进行回收</li>
<li>如何回收</li>
</ul>
<p>解决这三个问题的过程直接映射出垃圾回收的基础理论。</p>
<h2 id="对象已死？"><a href="#对象已死？" class="headerlink" title="对象已死？"></a>对象已死？</h2><p>普遍用于判断对象已死的方法有两种<code>引用计数器</code>和<code>根可达</code>。<code>引用计数器</code>是最直观简单的一种实现方式，但是因为存在循环引用的缺陷所以被Java虚拟机放弃。<code>根可达</code>的方式选择程序中一些明显可以确认存活的对象作为<code>GC Root</code>，然后通过程序中所有对象之间的引用关系有向图，凡是那些在有向图中从<code>GC Root</code>出发不可达的对象都会被判定为无用对象。<code>GC Root</code>通常选用的对象是栈帧中引用的对象或者是方法区中的静态变量这些可以明显确认存活的对象。</p>
<p><code>根可达</code>的方式只是判断对象是否存活的开始，在此之后对象仍然有机会去拯救自己。虚拟机对<code>根可达</code>中筛选出来的嫌疑对象进行判断，凡是实现了<code>finalize()</code>函数并且之前没有执行过该函数（该函数在对象生命周期中只能执行一次）的对象将会被放置到一个队列中，并且放到一个优先级相对较低的线程中执行这些的对象的<code>finalze()</code>。如果对象在自己的<code>finalze()</code>函数中成功自救（自救的方式是对自己增加一个可以保证根可达的引用），则可以将自己的垃圾对象标识清除。但是虚拟机的实现并不会保证<code>finalze()</code>函数的执行完成，所以慎用。</p>
<p>在谈及对象自救方式是说的是对当前对象增加一条根可达的引用。但是这里提及的引用并不是保存对象地址的狭义上的引用，Java在1.2版本之后对引用的类型进行的细分，增加了更多状态的引用。</p>
<p><em>强引用</em> 指的是平时在开发中直接使用的对象引用，强引用会一直保证该对象处于被使用的状态。</p>
<p><em>软引用</em> 描述的是那些有用但是非必须的对象。软引用关联的对象在程序将要发生OOM的时候会被回收掉，如果在这次清理之后仍然没有足够的内存空间，则程序依然会抛出OOM的异常。Java中通过<code>SoftReference</code>类实现软引用。</p>
<p><em>弱引用</em> 和软引用一样用来描述那些可有可无的对象，只是弱引用比软引用的强度要更低一些。弱引用关联的对象在内存中只能够存活到第二次垃圾回收，当那次垃圾回收来到的时候，不管内存中的剩余空间是否足够，弱引用的对象都将会被回收掉。Java中通过<code>WeakReference</code>类实现弱引用</p>
<p><em>虚引用</em> 的存不会对该对象的存活时间形成任何的影响，通过虚引用也无法获取到它关联的对象，增加虚引用的的目的只是为了在对象被回收的时候可以收到一个通知。Java中通过<code>PhantomReference</code>对象实现虚引用。</p>
<h2 id="如何回收"><a href="#如何回收" class="headerlink" title="如何回收"></a>如何回收</h2><p>虚拟机将堆内存规划成下面的这种模型：年轻代和老龄代并存，年轻代中划分成eden、survivor1、survivor2三块区域，使用其中一块survivor内存作为下次内存清理完之后存活对象的放置场所。</p>
<p>在程序中创建了一个对象之后需要在堆内存中为这个对象分配一块空间。在决定在什么地方分配这块内存空间之前，首先要检查一下这个对象是否为大对象，大对象的标准通过虚拟机的设置参数决定。如果确定该对象为大对象则直接将其内存空间分配在老年代，否则优先分配到年轻代内存块中。</p>
<blockquote><p>新生代GC(Minor GC)：指发生在新生代的垃圾收集动作，因为Java对象大多具备朝生夕死的特性，所以Minor GC发生的非常频繁，一般回收速度也很快。<br>老年代GC(Major GC / Full GC)：指发生在老年代的GC，出现了Major GC，经常会伴随至少一次的Minor GC。Major GC的速度一般会比Minor GC慢10倍以上。</p>
<footer><strong>深入理解Java虚拟机</strong></footer></blockquote>
<p>如果最后决定将这个对象放置在年轻代内存区域中，则先判断当前区域中是否有足够的内存空间给这个对象，如果有足够的内存空间就直接分配，否则就触发垃圾回收。在这次垃圾回收开始的时候，垃圾回收器首先要判断之前每次转移到老年代的内存平均值是否大于老年代当前剩余的内存。如果大于则改为触发一次Major GC，否则再去查看HandlePromotionFailure设置是否允许担保失败，如果允许的话直接执行Minor GC，不然的话就执行Major GC。</p>
<p>堆内存模型创建的时候分成年轻代和老年代，对这两种不同类型内存模块使用不同的垃圾回收算法。</p>
<p>年轻代使用的是复制算法。因为年轻代中的对象大多具备朝生夕死的特性，所以在年轻代中只使用其中一块survivor保存回收之后存活下来的对象。在年轻代中，每次使用Eden和其中一块survivor分配空间给新生对象，当发生垃圾回收的时候将其中存活下来的对象复制移动到空闲的另一块survivor中。这要保证了内存的对齐和回收的速率。</p>
<p>老年代使用的是标记-整理算法。对于该次回收中存活对象进行标记并向内存区域的一端移动，对剩余空间进行清理操作。老年代不采用和年轻代同样垃圾回收算法的原因是老年代存活对象的数量比较多，垃圾回收的效率不高。</p>
<p>在介绍整个回收流程的时候可以看到每次触发Minor GC的时候都会伴随着Major GC的检查过程。这个是因为Minor GC只是用一块survivor保存清除之后存活的对象在一些特殊情况下可能是不够的，当这种情况发生的时候就需要用到老年代的内存进行一次担保保证这个GC可以正常的完成。</p>
<p>前面有说到，新创建的对象默认的情况下应该是直接分配在年轻代中，只有当这些对象达到一定的条件之后才会进入到老年代的内存中。对于新创建的对象，只要大于当前虚拟机设定的大对象的值之后，该对象就会直接被分配到老年代的内存中。此外，年轻代中对象会有一个标识其年龄的值，每当该对象经历一次GC并且成功存活之后年龄就会自动增加，当其达到我们设定的年龄阈值之后就会被移动到老年代中。年龄判断的机制并不是只有这种情况，如果年轻代中达到某个年龄的对象占用了一半以上的内存，那么大于等于该年龄值的对象也一样会被移动到老年代中。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/03/Android内存分析（1）-MAT/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhijianz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.svg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zhijianz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/03/Android内存分析（1）-MAT/" itemprop="url">
                  Android性能分析（1）- MAT分析内存
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-03T09:46:48+08:00">
                2017-05-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="缘由"><a href="#缘由" class="headerlink" title="缘由"></a>缘由</h1><p>应用开发的过程中，需要去重点关心应用内存使用情况的情形基本上都是运行的过程中出现了OOM。而出现OOM通常的原因是代码写出问题导致的内存泄漏，另外一种就是应用在某个时间段集中请求大量的内存导致在一些老旧的机器上出现应用内存不足OOM的情况。最近在项目的开发过程中，就是遇到了后面的这种情况。下面的内容主要是用来记录在解决这个问题的过程中学习到的一些内容。</p>
<h1 id="MAT"><a href="#MAT" class="headerlink" title="MAT"></a>MAT</h1><p><code>Mat</code>将堆转存文件的信息分析完之后，提供给开发者其中每个对象内存占用情况以及相关的引用情况作为内存分析的依据。在使用<code>Mat</code>进行内存分析之前需要了解其相关的几个基本概念:</p>
<h3 id="Shallow-Heap"><a href="#Shallow-Heap" class="headerlink" title="Shallow Heap"></a>Shallow Heap</h3><p><code>Shallow Heap</code>指代的是java对象自身分配堆的内存大小，不包括其引用的相关对象占用的内容大小，这些引用在计算的时候都只会按照引用占用内存的32bit或64bit计算</p>
<h3 id="Retained-Heap"><a href="#Retained-Heap" class="headerlink" title="Retained Heap"></a>Retained Heap</h3><p>每个对象除了自身引用存储时占用着内存之外，通过保持这些引用导致对象无法被回收同样会占用一部分内容，<code>Retained Heap</code>指的是该对象被回收之后，可以从堆上释放内存的总量</p>
<h3 id="Dominator-Tree"><a href="#Dominator-Tree" class="headerlink" title="Dominator Tree"></a>Dominator Tree</h3><blockquote>
<p>假如从GC Root 到达obj-b的所有访问路径都必然经过obj-a，这种情况称为obj-a dominate obj-b，同时，obj-a 为 obj-b的dominator</p>
</blockquote>
<p><code>Mat</code>提供的<code>Dominator-Tree</code>视图列举了当前hprof文件中所有的大对象以及这些大对象所控制的对象列表</p>
<h3 id="Histogram"><a href="#Histogram" class="headerlink" title="Histogram"></a>Histogram</h3><p><code>Mat</code>提供的<code>Histogram</code>视图列举了hprof文件中所有的对象，在这个视图中我们可以通过查询操作找到我们感兴趣的对象，进而查询相关的引用。</p>
<h3 id="List-Object"><a href="#List-Object" class="headerlink" title="List Object"></a>List Object</h3><p>当我们对<code>Mat</code>上述两种视图提供的对象列表中某个对象产生怀疑并且希望查看其对应的引用情况的时候，右键点击该对象可以看到一个<code>list object</code>的选项，其中有<code>with outgoing references</code>/<code>with incoming references</code>两种子选项。<code>with outgoing references</code>的功能是列举出所有被当前对象所引用到的对象，<code>with incoming references</code>与之相反，列举出所有引用当前对象的对象。这两种选择根据当前分析的目的和方向适当选用。</p>
<h3 id="Path-to-GC-Roots"><a href="#Path-to-GC-Roots" class="headerlink" title="Path to GC Roots"></a>Path to GC Roots</h3><p><code>Path to GC Roots</code>可以显示出当前对象到<code>GC Roots</code>的引用可达路径，通过这个路径可以清楚的看出来应用中的那些对象直接或间接地引用到这个对象，如果这种引用不是必要的可以通过将这些非必要引用去除来回收这部分的内存空间。</p>
<h2 id="分析的方法"><a href="#分析的方法" class="headerlink" title="分析的方法"></a>分析的方法</h2><p>对于内存泄漏的情况，通常使用<code>leak canary</code>之类的工具会更加方便，如果要使用<code>Mat</code>进行泄漏的分析通常也会有一个分析的目标对象。如果目标对象是一个activity，那么最明显的特征就是在<code>Histogram</code>中这个activity会存在多个实例；如果没有这种情况出现，对于所有的目标对象都可以分析谁持有了该对象并找到其中不合理的地方。</p>
<p>而对于程序大内存问题的分析，则需要用<code>Dominator Tree</code>视图去找到这些大内存对象以及他们到<code>GC Roots</code>的可达路径，通过这些可达路径去分析那些引用是不需要可以优化的内容</p>
<h1 id="参考内容"><a href="#参考内容" class="headerlink" title="参考内容"></a>参考内容</h1><ul>
<li><a href="http://help.eclipse.org/luna/index.jsp?topic=%2Forg.eclipse.mat.ui.help%2Fconcepts%2Fdominatortree.html&amp;cp=39_2_2" target="_blank" rel="external">MAT 文档对于相关概念的解析</a></li>
<li><a href="http://www.lightskystreet.com/2015/09/01/mat_usage/" target="_blank" rel="external">一份比较详细的MAT使用教程</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/01/ADB常用命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zhijianz">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.svg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zhijianz">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/01/ADB常用命令/" itemprop="url">
                  ADB常用命令
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-01T00:50:20+08:00">
                2017-05-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>显示所有已安装应用程序</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ adb shell pm list packages</div></pre></td></tr></table></figure>
<ul>
<li>卸载某个已安装的应用程序</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ adb uninstall &lt;package_name&gt;</div></pre></td></tr></table></figure>
<ul>
<li>设置应用模式启动时等待调试链接，代替debug模式启动。用完之后需要调用第二条命令清除该设置，否则将会一直生效。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ adb shell am <span class="built_in">set</span>-debug-app -w --persistent &lt;package_name&gt;</div><div class="line">$ adb shell am clear-debug-app &lt;package_name&gt;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.svg"
               alt="zhijianz" />
          <p class="site-author-name" itemprop="name">zhijianz</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhijianz</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
